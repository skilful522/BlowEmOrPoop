(()=>{"use strict";var t={d:(s,i)=>{for(var e in i)t.o(i,e)&&!t.o(s,e)&&Object.defineProperty(s,e,{enumerable:!0,get:i[e]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s)};t.d({},{wZ:()=>p,JN:()=>l,hM:()=>v});const s=document.getElementById("canvas1"),i=s.getContext("2d");s.width=800,s.height=500;const e=new Image;e.src="../assets/images/bubble.png";class h{constructor(){this.x=Math.random()*s.width,this.y=s.height+100,this.radius=25,this.spriteWidth=394,this.spriteHeight=512,this.frame=0,this.frameX=0,this.frameY=0,this.speed=6*Math.random(),this.sound=Math.random()<=.5?"sound1":"sound2",this.spriteRows=2,this.spriteColumns=4,this.isCollision=!1,this.sprites=this.spriteColumns*this.spriteRows,this.distance}update(){this.y-=this.speed;const t=this.x-v.x,s=this.y-v.y;this.distance=Math.sqrt(t*t+s*s),p%20==0&&(this.frame++,this.isCollision&&this.changeSprite())}changeSprite(){return this.frame%this.spriteColumns==0&&this.frame!==this.sprites?(this.frameY++,void(this.frameX=1)):this.frame>=this.sprites?(this.frame=0,this.frameX=1,void(this.frameY=0)):void this.frameX++}draw(){i.drawImage(e,this.frameX*this.spriteWidth,this.frameY*this.spriteHeight,this.spriteWidth,this.spriteHeight,this.x-40,this.y-40,3*this.radius,3*this.radius)}}const a=new Image;a.src="../assets/images/playerLeft.png";const r=new Image;r.src="../assets/images/playerRight.png";const n=new Image;n.src="../assets/images/background1.png";const d={x1:0,x2:s.width,y:0,width:s.width,height:s.height};class o{constructor(){this.x=s.width+500,this.y=Math.random()*s.height,this.radius=50,this.speed=5*Math.random(),this.enemy=Math.floor(4*Math.random())+1,this.img=new Image}update(){this.x-=this.speed;const t=this.x-v.x,s=this.y-v.y;this.distance=Math.sqrt(t*t+s*s)}draw(){this.img.src=`../assets/images/enemies/enemy${this.enemy}.png`,i.drawImage(this.img,0,0,this.img.width,this.img.height,this.x-50,this.y-50,2*this.radius,2*this.radius)}}const m=(t,s)=>t.distance<t.radius+s.radius;let p=0,l=1,g=!1,c=0;const u=new Audio("./assets/sounds/gameOver.mp3"),w=new Audio("./assets/sounds/fishPassBy.mp3"),f=new Audio("./assets/sounds/environment.mp3"),y={x:s.width/2,y:s.height/2,click:"false"};let x=s.getBoundingClientRect();s.addEventListener("mousedown",(t=>{y.click=!0,w.play(),y.x=t.x-x.left,y.y=t.y-x.top})),s.addEventListener("mouseup",(t=>{y.click=!1}));const v=new class{constructor(){this.x=s.width,this.y=s.height/2,this.radius=50,this.isSwimming=!1,this.angle=0,this.frameX=0,this.frameY=0,this.frame=0,this.spriteWidth=498,this.spriteHeight=327,this.spriteRows=3,this.spriteColumns=4,this.sprites=this.spriteColumns*this.spriteRows}changeSprite(){return this.frame%this.spriteColumns==0&&this.frame!==this.sprites?(this.frameY++,void(this.frameX=0)):this.frame>=this.sprites?(this.frame=0,this.frameX=0,void(this.frameY=0)):void this.frameX++}update(t){this.isSwimming=!0;const s=this.x-t.x,i=this.y-t.y,e=Math.atan2(i,s);s<=15&&i<=15&&(this.isSwimming=!1),this.angle=e,t.x!==this.x&&(this.x-=s/30),t.y!==this.y&&(this.y-=i/30),p%5==0&&(this.frame++,this.changeSprite())}draw(t){t.click&&(i.lineWidth=.2,i.beginPath(),i.moveTo(this.x,this.y),i.lineTo(t.x,t.y),i.stroke()),i.save(),i.translate(this.x,this.y),i.rotate(this.angle),this.x>=t.x?i.drawImage(a,this.frameX*this.spriteWidth,this.frameY*this.spriteHeight,this.spriteWidth,this.spriteHeight,-55,-40,this.spriteWidth/4,this.spriteHeight/4):i.drawImage(r,this.frameX*this.spriteWidth,this.frameY*this.spriteHeight,this.spriteWidth,this.spriteHeight,-55,-40,this.spriteWidth/4,this.spriteHeight/4),i.restore()}},M=[...Array(10).keys()].map((()=>new h)),b=[...Array(0).keys()].map((()=>new o)),C=document.createElement("audio");C.src="../assets/sounds/Plop.ogg";const I=document.createElement("audio");I.src="../assets/sounds/bubbles-single2.wav";const S=()=>{g&&(f.pause(),setInterval((()=>{u.play(),i.fillStyle="black",i.fillRect(Math.floor(Math.random()*s.width),Math.floor(Math.random()*s.height),20,20),i.fillStyle="brown",i.font="48px sans-serif",i.fillText("Вляпался ☹",s.width/2-150,s.height/2),i.font="24px sans-serif",i.fillText("Попробуй ещё раз f5",s.width/2-150,(s.height+100)/2)}))),g||(i.clearRect(0,0,s.width,s.height),d.x1-=l,d.x1<-d.width&&(d.x1=d.width),d.x2-=l,d.x2<-d.width&&(d.x2=d.width),i.drawImage(n,d.x1,d.y,d.width,d.height),i.drawImage(n,d.x2,d.y,d.width,d.height),(()=>{p%50==0&&M.push(new h);for(let t=0;t<M.length;t++){const s=M[t];s.y<0-2*s.radius&&(M.splice(t,1),t--),m(s,v)&&(s.isCollision||("sound1"===s.sound?C.play():I.play(),c++,s.isCollision=!0)),s.update(),s.draw()}})(),p%200==0&&b.push(new o),b.forEach((t=>{m(t,v)&&(g=!0),t.update(),t.draw()})),v.update(y),!v.isSwimming&&w.pause(),v.draw(y),i.font="24px sans-serif",i.fillStyle="black",i.fillText(`Счёт: ${c}`,10,50),p++,requestAnimationFrame(S))};S(),f.play(),window.addEventListener("resize",(()=>{x=s.getBoundingClientRect()}))})();